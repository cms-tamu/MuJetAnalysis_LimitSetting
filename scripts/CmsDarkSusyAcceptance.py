def fCmsDarkSusyAcceptance_LinearFit_2015_13TeV(ctau_mm, mGammaD_GeV, isLxy = "noLxy"):
  if isLxy == "noLxy":
    return fCmsDarkSusyAcceptance_LinearFit_2015_13TeV_noLxy(ctau_mm, mGammaD_GeV)[0]
  elif isLxy == "Lxy":
    return fCmsDarkSusyAcceptance_LinearFit_2015_13TeV_Lxy(ctau_mm, mGammaD_GeV)[0]
  else:
    raise Exception, "Unknown isLxy = %s" % isLxy

def fCmsDarkSusyAcceptanceUnct_LinearFit_2015_13TeV(ctau_mm, mGammaD_GeV, isLxy = "noLxy"):
  if isLxy == "noLxy":
    return fCmsDarkSusyAcceptance_LinearFit_2015_13TeV_noLxy(ctau_mm, mGammaD_GeV)[1]
  elif isLxy == "Lxy":
    return fCmsDarkSusyAcceptance_LinearFit_2015_13TeV_Lxy(ctau_mm, mGammaD_GeV)[1]
  else:
    raise Exception, "Unknown isLxy = %s" % isLxy

def fCmsDarkSusyAcceptance_LinearFitToArray_2015_13TeV(ctau_mm, mGammaD_GeV, AcceptanceFromMC):
    # Masses: 0.25 up to 8.5 GeV
    # ct: 0 - 100 mm
    # All masses have ct from 0 to 5, but 1.5 GeV haven't 0.5. (0.25 GeV from 0 to 100; 2 GeV from 0 to 100 but not 50)
    if ((mGammaD_GeV is not 0.25 or mGammaD_GeV is not 2.0) and ctau_mm > 5): raise Exception, "Wrong combination of %g and %g" % mGammaD_GeV, ctau_mm
    if ( mGammaD_GeV is 2.0 and ctau_mm is 50 ): raise Exception, "Wrong combination of %g and %g" % mGammaD_GeV, ctau_mm

    for mlow, mhigh in [ (0.25,0.275), (0.275,0.3), (0.3,0.4), (0.4,0.7), (0.7,1.), (1.,1.5), (1.5,2.), (2.,8.5) ]:
        for ctaulow, ctauhigh in [ (0.0,0.05), (0.05,0.1), (0.1,0.2), (0.2,0.5), (0.5,1.), (1.,2.), (2.,3.), (3.,5.), (5.,10.), (10.,20.), (20.,30.), (30.,40.), (40.,50.), (50.,100.) ]:
            if ((mlow is 1.5 or mhigh is 1.5) and (ctaulow is 0.5 or ctauhigh is 0.5)):
                if( ctaulow is 0.5 ):
                    ctaulow = 0.2
                else:
                    ctauhigh = 0.2
            if ctaulow <= ctau_mm <= ctauhigh and mlow <= mGammaD_GeV <= mhigh:
                break
        if ctaulow <= ctau_mm <= ctauhigh and mlow <= mGammaD_GeV <= mhigh:
            break

    ctauinc = (ctau_mm - ctaulow)/(ctauhigh - ctaulow)
    minc = (mGammaD_GeV - mlow)/(mhigh - mlow)
    Acceptance_LinearFit = (1. - ctauinc)*(1. - minc)*AcceptanceFromMC[ctaulow, mlow][0] + (ctauinc)*(1. - minc)*AcceptanceFromMC[ctauhigh, mlow][0] + (ctauinc)*(minc)*AcceptanceFromMC[ctauhigh, mhigh][0] + (1. - ctauinc)*(minc)*AcceptanceFromMC[ctaulow, mhigh][0]
    AcceptanceUncert_LinearFit = (1. - ctauinc)*(1. - minc)*AcceptanceFromMC[ctaulow, mlow][1] + (ctauinc)*(1. - minc)*AcceptanceFromMC[ctauhigh, mlow][1] + (ctauinc)*(minc)*AcceptanceFromMC[ctauhigh, mhigh][1] + (1. - ctauinc)*(minc)*AcceptanceFromMC[ctaulow, mhigh][1]
    return Acceptance_LinearFit, AcceptanceUncert_LinearFit

################################################################################
#             2015 data 13 TeV Regular analysis cuts, no cut on Lxy              
################################################################################

# (ctau in mm, mGammaD in GeV) : (acceptance,acceptance_err)
CmsDarkSusyAcceptance_PointsFromMC_2015_13TeV_noLxy = {
(0, 0.25): (0.141405, 0.00103904),
(0.05, 0.25): (0.14125, 0.00107305),
(0.1, 0.25): (0.140593, 0.00105804),
(0.2, 0.25): (0.140244, 0.00102739),
(0.5, 0.25): (0.14045, 0.00102908),
(1, 0.25): (0.140303, 0.00103708),
(2, 0.25): (0.141563, 0.00104583),
(3, 0.25): (0.141243, 0.00103234),
(5, 0.25): (0.141518, 0.00105825),
(10, 0.25): (0.140696, 0.000629124),
(20, 0.25): (0.141244, 0.000660938),
(50, 0.25): (0.140949, 0.000356973),
(100, 0.25): (0.141582, 0.000344737),
(0, 0.275): (0.124987, 0.0011963),
(0.05, 0.275): (0.126563, 0.00123654),
(0.1, 0.275): (0.12487, 0.00096209),
(0.2, 0.275): (0.126508, 0.000978806),
(0.5, 0.275): (0.127492, 0.00123334),
(1, 0.275): (0.125562, 0.00126014),
(2, 0.275): (0.125522, 0.00104752),
(3, 0.275): (0.126439, 0.00174543),
(5, 0.275): (0.125029, 0.00151542),
(0, 0.3): (0.114193, 0.00125915),
(0.05, 0.3): (0.115269, 0.00153234),
(0.1, 0.3): (0.113148, 0.000991964),
(0.2, 0.3): (0.115666, 0.00105134),
(0.5, 0.3): (0.113899, 0.000939462),
(1, 0.3): (0.12, 0.0064307),
(2, 0.3): (0.113486, 0.000921689),
(3, 0.3): (0.114623, 0.000935457),
(5, 0.3): (0.11491, 0.00138281),
(0, 0.4): (0.0977534, 0.000857318),
(0.05, 0.4): (0.097622, 0.000918541),
(0.1, 0.4): (0.0979631, 0.00126),
(0.2, 0.4): (0.098731, 0.00172989),
(0.5, 0.4): (0.098122, 0.000892565),
(1, 0.4): (0.0975881, 0.00103109),
(2, 0.4): (0.0976, 0.00113951),
(3, 0.4): (0.0984598, 0.00109471),
(5, 0.4): (0.0978714, 0.000976215),
(0, 0.7): (0.0914, 0.000829433),
(0.05, 0.7): (0.0914084, 0.000800979),
(0.1, 0.7): (0.0913887, 0.000814081),
(0.2, 0.7): (0.0925777, 0.000860034),
(0.5, 0.7): (0.0924362, 0.000864073),
(1, 0.7): (0.0922679, 0.00134152),
(2, 0.7): (0.0913251, 0.000994602),
(3, 0.7): (0.0919331, 0.000819433),
(5, 0.7): (0.0907921, 0.00140039),
(0, 1): (0.092008, 0.000895647),
(0.05, 1): (0.0909339, 0.000919826),
(0.1, 1): (0.0917039, 0.000811568),
(0.2, 1): (0.0911119, 0.000833785),
(0.5, 1): (0.0915523, 0.000856424),
(1, 1): (0.0914826, 0.000878098),
(2, 1): (0.0913874, 0.000947919),
(3, 1): (0.0931165, 0.00105042),
(5, 1): (0.0922559, 0.000927049),
(0, 2): (0.0872266, 0.00111123),
(0.05, 2): (0.089477, 0.00111508),
(0.1, 2): (0.0884217, 0.00110234),
(0.2, 2): (0.0877778, 0.00109799),
(0.5, 2): (0.0889286, 0.00111138),
(1, 2): (0.0883163, 0.00110724),
(2, 2): (0.0888131, 0.00110498),
(3, 2): (0.0877261, 0.00112646),
(5, 2): (0.0890816, 0.00111241),
(10, 2): (0.0896259, 0.000471251),
(20, 2): (0.0893485, 0.000471266),
(100, 2): (0.0830837, 0.000290953),
(0, 8.5): (0.203321, 0.0017816),
(0.05, 8.5): (0.20431, 0.00178992),
(0.1, 8.5): (0.203325, 0.00177564),
(0.2, 8.5): (0.203396, 0.00175798),
(0.5, 8.5): (0.204066, 0.00176136),
(1, 8.5): (0.202247, 0.00175217),
(2, 8.5): (0.202806, 0.00176393),
(3, 8.5): (0.201189, 0.00222534),
(5, 8.5): (0.204003, 0.00176104),
(0, 1.5): (0.0893357, 0.000822791),
(0.05, 1.5): (0.0892341, 0.000840002),
(0.1, 1.5): (0.0893143, 0.00136131),
(0.2, 1.5): (0.0879909, 0.000933962),
(1, 1.5): (0.090312, 0.00100367),
(2, 1.5): (0.0894076, 0.000993148),
(3, 1.5): (0.0889964, 0.000833513),
(5, 1.5): (0.0896827, 0.000834743),
}

def fCmsDarkSusyAcceptance_LinearFit_2015_13TeV_noLxy(ctau_mm, mGammaD_GeV):
  return fCmsDarkSusyAcceptance_LinearFitToArray_2015_13TeV(ctau_mm, mGammaD_GeV, CmsDarkSusyAcceptance_PointsFromMC_2015_13TeV_noLxy)

################################################################################
#             2015 data 8 TeV Regular analysis cuts, cut on Lxy < 4.4 cm        
################################################################################

# (ctau in mm, mGammaD in GeV) : (acceptance)
CmsDarkSusyAcceptance_PointsFromMC_2015_13TeV_Lxy = {
(0, 0.25): (0.141405, 0.00103904),
(0.05, 0.25): (0.140664, 0.00107055),
(0.1, 0.25): (0.136398, 0.00104021),
(0.2, 0.25): (0.119201, 0.000938401),
(0.5, 0.25): (0.0650512, 0.000676808),
(1, 0.25): (0.0284706, 0.000443676),
(2, 0.25): (0.00982064, 0.000259077),
(3, 0.25): (0.00515702, 0.000185127),
(5, 0.25): (0.00170537, 0.000108823),
(10, 0.25): (0.000466103, 3.39119e-05),
(20, 0.25): (0.000143631, 1.97307e-05),
(50, 0.25): (1.8225e-05, 3.80022e-06),
(100, 0.25): (5.14706e-06, 1.94541e-06),
(0, 0.275): (0.124987, 0.0011963),
(0.05, 0.275): (0.12608, 0.00123391),
(0.1, 0.275): (0.12197, 0.000949628),
(0.2, 0.275): (0.110024, 0.000906109),
(0.5, 0.275): (0.0637566, 0.000847165),
(1, 0.275): (0.0283146, 0.00057197),
(2, 0.275): (0.00993398, 0.000279148),
(3, 0.275): (0.00436364, 0.000306182),
(5, 0.275): (0.00186122, 0.000174482),
(0, 0.3): (0.114193, 0.00125915),
(0.05, 0.3): (0.114886, 0.00152952),
(0.1, 0.3): (0.111023, 0.000981666),
(0.2, 0.3): (0.102981, 0.000986356),
(0.5, 0.3): (0.0607722, 0.000669668),
(1, 0.3): (0.0316923, 0.00317183),
(2, 0.3): (0.00972101, 0.000256879),
(3, 0.3): (0.00514384, 0.000188183),
(5, 0.3): (0.002, 0.000172946),
(0, 0.4): (0.0977534, 0.000857318),
(0.05, 0.4): (0.0974646, 0.000917734),
(0.1, 0.4): (0.0970923, 0.00125389),
(0.2, 0.4): (0.0928, 0.00167259),
(0.5, 0.4): (0.0653087, 0.000717224),
(1, 0.4): (0.0342333, 0.000592804),
(2, 0.4): (0.013503, 0.000407288),
(3, 0.4): (0.00696953, 0.00027886),
(5, 0.4): (0.00325499, 0.000170185),
(0, 0.7): (0.0914, 0.000829433),
(0.05, 0.7): (0.0913762, 0.000800827),
(0.1, 0.7): (0.0911694, 0.000813022),
(0.2, 0.7): (0.0912249, 0.000853198),
(0.5, 0.7): (0.0802884, 0.000800806),
(1, 0.7): (0.055375, 0.00102157),
(2, 0.7): (0.0270968, 0.000525584),
(3, 0.7): (0.0157458, 0.00032708),
(5, 0.7): (0.00653465, 0.000360894),
(0, 1): (0.092008, 0.000895647),
(0.05, 1): (0.0909254, 0.000919779),
(0.1, 1): (0.091625, 0.000811189),
(0.2, 1): (0.0906084, 0.000831286),
(0.5, 1): (0.0861872, 0.000828906),
(1, 1): (0.0689421, 0.00075437),
(2, 1): (0.0396937, 0.00060975),
(3, 1): (0.0254526, 0.000531913),
(5, 1): (0.0120682, 0.000322753),
(0, 2): (0.0872266, 0.00111123),
(0.05, 2): (0.089477, 0.00111508),
(0.1, 2): (0.0884217, 0.00110234),
(0.2, 2): (0.0877652, 0.00109791),
(0.5, 2): (0.0880485, 0.00110542),
(1, 2): (0.0830612, 0.00107119),
(2, 2): (0.0668182, 0.000948702),
(3, 2): (0.0500266, 0.000835779),
(5, 2): (0.0305102, 0.000633273),
(10, 2): (0.0124684, 0.000169431),
(20, 2): (0.00385853, 9.40126e-05),
(100, 2): (0.000163688, 1.24101e-05),
(0, 8.5): (0.203321, 0.0017816),
(0.05, 8.5): (0.20431, 0.00178992),
(0.1, 8.5): (0.203325, 0.00177564),
(0.2, 8.5): (0.203384, 0.00175791),
(0.5, 8.5): (0.203977, 0.00176091),
(1, 8.5): (0.202096, 0.0017514),
(2, 8.5): (0.200319, 0.00175126),
(3, 8.5): (0.19416, 0.00217972),
(5, 8.5): (0.18, 0.00163763),
(0, 1.5): (0.0893357, 0.000822791),
(0.05, 1.5): (0.0892341, 0.000840002),
(0.1, 1.5): (0.0892952, 0.00136115),
(0.2, 1.5): (0.0878633, 0.00093323),
(1, 1.5): (0.0794271, 0.000936532),
(2, 1.5): (0.056638, 0.000778482),
(3, 1.5): (0.0397133, 0.000544048),
(5, 1.5): (0.0217326, 0.000397899),
}

def fCmsDarkSusyAcceptance_LinearFit_2015_13TeV_Lxy(ctau_mm, mGammaD_GeV):
  return fCmsDarkSusyAcceptance_LinearFitToArray_2015_13TeV(ctau_mm, mGammaD_GeV, CmsDarkSusyAcceptance_PointsFromMC_2015_13TeV_Lxy)

################################################################################
#                Functions to model acceptance w.r.t. ctau                      
################################################################################
